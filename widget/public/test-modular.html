<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pingbash Chat Widget - Modular Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }
        h1 {
            margin-bottom: 30px;
        }
        .info {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: left;
        }
        .info h3 {
            margin-top: 0;
        }
        .info ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        .debug-info {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 12px;
            text-align: left;
        }
        .debug-info h4 {
            margin-top: 0;
            color: #ffd700;
        }
        .test-buttons {
            margin: 20px 0;
        }
        .test-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .test-btn:hover {
            background: rgba(255,255,255,0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Pingbash Chat Widget - Modular Version Test</h1>
        
        <div class="info">
            <h3>üì¶ Modular Architecture</h3>
            <p>This version splits the widget into multiple modules:</p>
            <ul>
                <li><strong>core.js</strong> - Basic widget class and configuration</li>
                <li><strong>styles.js</strong> - CSS styling</li>
                <li><strong>ui.js</strong> - HTML generation and UI methods</li>
                <li><strong>socket.js</strong> - Socket.IO communication</li>
                <li><strong>auth.js</strong> - Authentication and user management</li>
                <li><strong>chat.js</strong> - Chat functionality and message handling</li>
                <li><strong>modals.js</strong> - Modals and popups</li>
                <li><strong>events.js</strong> - Event listeners and interactions</li>
            </ul>
        </div>

        <div class="info">
            <h3>‚ú® Features</h3>
            <ul>
                <li>üîê Authentication (Sign in or Continue as Guest)</li>
                <li>üí¨ Real-time messaging with Socket.IO</li>
                <li>‚Ü©Ô∏è Reply to messages</li>
                <li>üì∑ Image and file uploads</li>
                <li>üòÄ Emoji picker</li>
                <li>@ Mention users</li>
                <li>üë• Online user count</li>
                <li>üìã Chat rules (editable by group creators)</li>
                <li>üèóÔ∏è Group creation (click logo)</li>
                <li>üçî Hamburger menu with admin features</li>
                <li>üì± Responsive design</li>
            </ul>
        </div>

        <div class="test-buttons">
            <h3>üß™ Test Functions</h3>
            <button class="test-btn" onclick="testWidget()">Test Widget Instance</button>
            <button class="test-btn" onclick="testGroupCreation()">Test Group Creation</button>
            <button class="test-btn" onclick="testChatRules()">Test Chat Rules</button>
            <button class="test-btn" onclick="clearTokens()">Clear All Tokens</button>
            <button class="test-btn" onclick="clearSeenRules()">Clear Seen Rules</button>
        </div>

        <div class="debug-info">
            <h4>üîç Debug Information</h4>
            <div id="debug-output">
                <p>Widget loading... Check console for detailed logs.</p>
            </div>
        </div>
    </div>

    <!-- Load the modular widget -->
    <script 
        src="./widget-modular.js"
        data-group-name="memine"
        data-api-url="https://pingbash.com"
        data-position="bottom-right"
        data-theme="light"
        data-width="500px"
        data-height="600px"
        data-auto-open="false">
    </script>

    <script>
        // Test functions
        function testWidget() {
            if (window.pingbashWidget) {
                console.log('‚úÖ Widget instance found:', window.pingbashWidget);
                updateDebugInfo('‚úÖ Widget instance is available and working!');
                
                // Test opening the widget
                if (window.pingbashWidget.openDialog) {
                    window.pingbashWidget.openDialog();
                    updateDebugInfo('‚úÖ Widget dialog opened successfully!');
                } else {
                    updateDebugInfo('‚ùå openDialog method not found');
                }
            } else {
                console.error('‚ùå Widget instance not found');
                updateDebugInfo('‚ùå Widget instance not found! Check console for errors.');
            }
        }

        function testGroupCreation() {
            if (window.pingbashWidget && window.pingbashWidget.testGroupCreationModal) {
                window.pingbashWidget.testGroupCreationModal();
                updateDebugInfo('üß™ Group creation modal test executed');
            } else {
                updateDebugInfo('‚ùå Group creation test method not available');
            }
        }

        function testChatRules() {
            if (window.pingbashWidget && window.pingbashWidget.testChatRules) {
                window.pingbashWidget.testChatRules();
                updateDebugInfo('üß™ Chat rules test executed');
            } else {
                updateDebugInfo('‚ùå Chat rules test method not available');
            }
        }

        function clearTokens() {
            if (window.pingbashWidget && window.pingbashWidget.clearAllTokens) {
                window.pingbashWidget.clearAllTokens();
                updateDebugInfo('üßπ All authentication tokens cleared');
            } else {
                updateDebugInfo('‚ùå Clear tokens method not available');
            }
        }

        function clearSeenRules() {
            if (window.pingbashWidget && window.pingbashWidget.clearSeenRules) {
                window.pingbashWidget.clearSeenRules();
                updateDebugInfo('üßπ Seen rules cleared');
            } else {
                updateDebugInfo('‚ùå Clear seen rules method not available');
            }
        }

        function updateDebugInfo(message) {
            const debugOutput = document.getElementById('debug-output');
            const timestamp = new Date().toLocaleTimeString();
            debugOutput.innerHTML += `<p>[${timestamp}] ${message}</p>`;
            debugOutput.scrollTop = debugOutput.scrollHeight;
        }

        // Monitor widget loading
        let checkCount = 0;
        const maxChecks = 50; // 5 seconds max
        
        function checkWidgetStatus() {
            checkCount++;
            
            if (window.pingbashWidget && window.pingbashWidget.config) {
                updateDebugInfo(`‚úÖ Widget loaded successfully after ${checkCount * 100}ms`);
                updateDebugInfo(`üìä Config: ${JSON.stringify(window.pingbashWidget.config, null, 2)}`);
                return;
            }
            
            if (checkCount < maxChecks) {
                setTimeout(checkWidgetStatus, 100);
            } else {
                updateDebugInfo('‚ùå Widget failed to load within 5 seconds');
            }
        }
        
        // Start monitoring
        setTimeout(checkWidgetStatus, 100);

        // Log any errors
        window.addEventListener('error', (e) => {
            updateDebugInfo(`‚ùå Error: ${e.message} (${e.filename}:${e.lineno})`);
        });
    </script>
</body>
</html> 